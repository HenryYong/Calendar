/*	Created @ 2016/11/6 By HenryYang
 **	Calendar.js, v0.0.1, MIT
 */
!function(a){function b(){}function c(a){var b,c,d,e,f,g,h,i,j,k=this,l=a||{},m=new Date;this.el=l.el||"#calendar",this.year=l.year||m.getFullYear(),this.month=l.month||m.getMonth()+1,this.datePosition=l.datePosition||"leftTop",this.leftTopHTML=l.leftTopHTML||"",this.leftBottomHTML=l.leftBottomHTML||"",this.rightTopHTML=l.rightTopHTML||"",this.rightBottomHTML=l.rightBottomHTML||"",this.iconPrev=l.iconPrev||"<",this.iconNext=l.iconNext||">",this.displayInfoOnDisabled=l.displayInfoOnDisabled||!1,this.thisMonthDateStyle=l.thisMonthDateStyle||"",this.lastMonthDateStyle=l.lastMonthDateStyle||"",this.nextMonthDateStyle=l.nextMonthDateStyle||"",this.weekStart=l.weekStart||0,this.showLastMonth=l.showLastMonth||"yes",this.showNextMonth=l.showNextMonth||"yes",this.preRenderCallback=l.preRenderCallback||function(){},this.postRenderCallback=l.postRenderCallback||function(){},this.hoverCallback=l.hoverCallback||function(){},this.outCallback=l.outCallback||function(){},this.clickCallback=l.clickCallback||function(){},this.allowHoverOnDisabled=l.allowHoverOnDisabled||!1,this.allowClickOnDisabled=l.allowClickOnDisabled||!1,this.data=l.data||{prev:{},current:{},next:{}},this.notAvailable=l.notAvailable||{prev:[],current:[],next:[]},b=document.querySelector(this.el),c={},d=this.getDaysOfMonth.bind(this),e=this.preRenderCallback.bind(this),f=this.postRenderCallback.bind(this),g=this.hoverCallback.bind(this),h=this.outCallback.bind(this),i=this.clickCallback.bind(this),this.language=l.language&&"zh"!=l.language?{year:"year",month:"month",week:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]}:{year:"年",month:"月",week:["星期一","星期二","星期三","星期四","星期五","星期六","星期日"]},this._getToolsDOM=function(){var a='<div class="calendar-tool"><button type="button" id="calendarPrev" class="calendar-prev" data-type="calendar-btn">'+this.iconPrev+'</button><span class="calendar-year-month"><span class="calendar-year" id="calendarYear" data-value=""></span>'+this.language.year+'<span class="calendar-month" id="calendarMonth" data-value=""></span>'+this.language.month+'</span><button type="button" id="calendarNext" class="calendar-next" data-type="calendar-btn">'+this.iconNext+"</button></div>";return a},this._countGapDays=function(a,b){return a==b?0:a>b?7-a+b:b>a?b-a:void 0},this._getCalendarDOM=function(a,b,c,e){var f,g,h,i,j,k,l,m,n,o,p,q,r="",s="",t="",u="",v=!1,w=1,x=1,y=this.weekStart,z=a,A=b;switch(1==b?(A=12,z=a-1):A=b-1,f=d(z,A),g=d(a,b),h=f-this._countGapDays(y,e)+1,i="",j=this.datePosition){case"leftTop":i+='<div class="calendar-date-leftBottom">'+this.leftBottomHTML+'</div><div class="calendar-date-rightTop">'+this.rightTopHTML+'</div><div class="calendar-date-rightBottom">'+this.rightBottomHTML+"</div>";break;case"leftBottom":i+='<div class="calendar-date-leftTop">'+this.leftTopHTML+'</div><div class="calendar-date-rightTop">'+this.rightTopHTML+'</div><div class="calendar-date-rightBottom">'+this.rightBottomHTML+"</div>";break;case"rightTop":i+='<div class="calendar-date-leftTop">'+this.leftTopHTML+'</div><div class="calendar-date-leftBottom">'+this.leftBottomHTML+'</div><div class="calendar-date-rightBottom">'+this.rightBottomHTML+"</div>";break;case"rightBottom":i+='<div class="calendar-date-leftTop">'+this.leftTopHTML+'</div><div class="calendar-date-leftBottom">'+this.leftBottomHTML+'</div><div class="calendar-date-rightTop">'+this.rightTopHTML+"</div>"}for(r+='<div class="calendar-date-row">',k=0;7>k;k++)y!=e?f>=h?(l="",v=this.isInArray(h,this.notAvailable.prev),s=" calendar-last-month",this.showLastMonth&&"yes"==this.showLastMonth&&(l+='<div class="calendar-date '+this.datePosition+" "+this.lastMonthDateStyle+'" data-type="date">'+h+"</div>"+(v&&!this.displayInfoOnDisabled?"":i),u=v?"not-available":""),r+='<div class="calendar-date-item '+u+s+'" data-type="calendar-item">'+l+"</div>",h++):(v=this.isInArray(x,this.notAvailable.current),u=v?"not-available":"",r+='<div class="calendar-date-item '+u+'" data-type="calendar-item"><div class="calendar-date '+this.datePosition+" "+this.thisMonthDateStyle+'" data-type="date">'+x+"</div>"+(v&&!this.displayInfoOnDisabled?"":i)+"</div>",x++):(v=this.isInArray(x,this.notAvailable.current),u=v?"not-available":"",r+='<div class="calendar-date-item '+u+'" data-type="calendar-item"><div class="calendar-date '+this.datePosition+" "+this.thisMonthDateStyle+'" data-type="date">'+x+"</div>"+(v&&!this.displayInfoOnDisabled?"":i)+"</div>",x++);for(r+="</div>",m=!0;m&&g>x;){for(r+='<div class="calendar-date-row">',k=0;7>k;k++)v=this.isInArray(x,this.notAvailable.current),u=v?"not-available":"",r+='<div class="calendar-date-item '+u+'" data-type="calendar-item"><div class="calendar-date '+this.datePosition+" "+this.thisMonthDateStyle+'" data-type="date">'+x+"</div>"+(v&&!this.displayInfoOnDisabled?"":i)+"</div>",x++;r+="</div>",x+6>g&&(m=!1)}if(g>=x){for(r+='<div class="calendar-date-row">',k=0;7>k;k++)g>x-1?(v=this.isInArray(x,this.notAvailable.current),u=v?"not-available":"",r+='<div class="calendar-date-item '+u+'" data-type="calendar-item"><div class="calendar-date '+this.datePosition+" "+this.thisMonthDateStyle+'" data-type="date">'+x+"</div>"+(v&&!this.displayInfoOnDisabled?"":i)+"</div>",x++):(n="",v=this.isInArray(w,this.notAvailable.current),t="calendar-next-month",this.showNextMonth&&"yes"==this.showNextMonth&&(n+='<div class="calendar-date '+this.datePosition+" "+this.nextMonthDateStyle+'" data-type="date">'+w+"</div>"+(v&&!this.displayInfoOnDisabled?"":i),u=v?"not-available":""),r+='<div class="calendar-date-item '+u+" "+t+'" data-type="calendar-item">'+n+"</div>",w++);r+="</div>"}for(o="",p=this.language,k=y;y+7>k;k++)q=7>k?k:k-7,o+='<div class="calendar-header-item">'+p.week[q]+"</div>";return'<div class="calendar-content"><div class="calendar-header">'+o+'</div><div class="calendar-body">'+r+"</div></div>"},this._setTools=function(a,d){var e=b.querySelector("#calendarYear"),f=b.querySelector("#calendarMonth");e.setAttribute("data-value",a),e.innerText=a,f.setAttribute("data-value",d),f.innerText=d,c.prev?(c.year=e.getAttribute("data-value"),c.month=f.getAttribute("data-value")):c={prev:document.querySelector("#calendarPrev"),next:document.querySelector("#calendarNext"),year:e.getAttribute("data-value"),month:f.getAttribute("data-value")}},this._renderData=function(){function a(a,b){var d,e,f=a.parentNode.parentNode,g=f.classList.toString(),h=Number(f.querySelector('[data-type="date"]').innerHTML);d=g.indexOf("calendar-last-month")>-1?c.prev[b][h]:g.indexOf("calendar-next-month")>-1?c.next[b][h]:c.current[b][h],e=a.parentNode.querySelectorAll('[data-value="'+b+'"]'),[].forEach.call(e,function(a,b){d&&(a.innerText=d instanceof Array?void 0==d[b]?"":d[b]:d)})}var c=this.data,d=b.querySelectorAll('[data-value="leftTop"]'),e=b.querySelectorAll('[data-value="leftBottom"]'),f=b.querySelectorAll('[data-value="rightTop"]'),g=b.querySelectorAll('[data-value="rightBottom"]'),h=c.prev.leftTop,i=c.prev.leftBottom,j=c.prev.rightTop,k=c.prev.rightBottom;d.length&&h&&[].forEach.call(d,function(b){a(b,"leftTop")}),e.length&&i&&[].forEach.call(e,function(b){a(b,"leftBottom")}),f.length&&j&&[].forEach.call(f,function(b){a(b,"rightTop")}),g.length&&k&&[].forEach.call(g,function(b){a(b,"rightBottom")})},this._updateCalender=function(a,c){this._setTools(a,c);var d=this._getCalendarDOM(a,c,this.getDaysOfMonth(a,c),this.getFirstDay(a,c));b.querySelector(".calendar-content").outerHTML=d,this._bindEvents().itemEventsBind()},this._render=function(a,c){var d,g=a||this.year,h=c||this.month,i=this._getCalendarDOM(g,h,this.getDaysOfMonth(g,h),this.getFirstDay(g,h));e(),b.childNodes.length?this._updateCalender(g,h):(d=this._getToolsDOM(),b.innerHTML=d+i,this._setTools(g,h)),this._renderData(),f()},j=this._render.bind(this),this._bindEvents=function(){return c.prev,c.next,{onceEventsBind:function(){[].forEach.call(b.querySelectorAll('[data-type="calendar-btn"]'),function(a){a.addEventListener("click",function(){e();var a=this,b=c.year,d=c.month,g=a.getAttribute("id");"calendarPrev"==g?1==d?(d=12,b--):d--:"calendarNext"==g&&(12==d?(d=1,b++):d++),k.year=b,k.month=d,j(b,d),f()},!1)})},itemEventsBind:function(){function a(a){a.addEventListener("mouseenter",function(){g.call(a)}),a.addEventListener("mouseleave",function(){h.call(a)})}function c(a){a.addEventListener("click",function(){i.call(a)})}[].forEach.call(b.querySelectorAll('[data-type="calendar-item"]'),function(b){b.className.indexOf("not-available")>-1?(k.allowHoverOnDisabled&&function(b){a(b)}(b),k.allowClickOnDisabled&&function(a){c(a)}(b)):function(b){a(b),c(b)}(b)})}}},this._trigger=function(a,b){var c;return document.createEventObject?(c=document.createEventObject(),a.fireEvent("on"+b,c)):(c=document.createEvent("HTMLEvents"),c.initEvent(b,!0,!0),!a.dispatchEvent(c))}}b.prototype.getDaysOfMonth=function(a,b){var c=0;switch(Number(b)){case 1:case 3:case 5:case 7:case 8:case 10:case 12:c=31;break;case 4:case 6:case 9:case 11:c=30;break;case 2:c=0==a%4||0==a%400&&0!=a%100?29:28}return c},b.prototype.getFirstDay=function(a,b){var c=-1,d=new Date(a,b-1,1);return c=d.getDay(),0==c?c=6:c-=1,c},b.prototype.isInArray=function(a,b){try{[].forEach.call(b,function(b){if(a==b)throw!1})}catch(c){return!0}return!1},c.prototype=new b,c.prototype.constructor=c,c.prototype.init=function(){this._render();var a=this._bindEvents();a.onceEventsBind(),a.itemEventsBind()},c.prototype.updateContent=function(a){var b,c,d,e,f=a||{};if(this.leftTopHTML=f.leftTopHTML?f.leftTopHTML:"",this.leftBottomHTML=f.leftBottomHTML?f.leftBottomHTML:"",this.rightTopHTML=f.rightTopHTML?f.rightTopHTML:"",this.rightBottomHTML=f.rightBottomHTML?f.rightBottomHTML:"",b=f.notAvailable,c=this.notAvailable,b)for(d in b)e=b[d],c[d]=e?e:[];else c={prev:[],current:[],next:[]};return this},c.prototype.render=function(a,b){return this._render(a,b),this},c.prototype.prev=function(){return this._trigger(document.querySelector("#calendarPrev"),"click"),this},c.prototype.next=function(){return this._trigger(document.querySelector("#calendarNext"),"click"),this},a.Calendar=c}(window);
