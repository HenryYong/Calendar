/*	Created @ 2016/11/6 By HenryYang
 **	Calendar.js, v0.0.1, MIT
 */
!function(a){function b(){}function c(a){var e,f,b=this,c=a||{},d=new Date;this.el=c.el||"#calendar",this.year=c.year||d.getFullYear(),this.month=c.month||d.getMonth()+1,this.datePosition=c.datePosition||"leftTop",this.leftTopHTML=c.leftTopHTML||"",this.leftBottomHTML=c.leftBottomHTML||"",this.rightTopHTML=c.rightTopHTML||"",this.rightBottomHTML=c.rightBottomHTML||"",this.iconPrev=c.iconPrev||"<",this.iconNext=c.iconNext||">",this.displayInfoOnDisabled=c.displayInfoOnDisabled||!1,this.thisMonthDateStyle=c.thisMonthDateStyle||"",this.lastMonthDateStyle=c.lastMonthDateStyle||"",this.nextMonthDateStyle=c.nextMonthDateStyle||"",this.weekStart=c.weekStart||0,this.showLastMonth=c.showLastMonth||"yes",this.showNextMonth=c.showNextMonth||"yes",this.preRenderCallback=c.preRenderCallback||function(){},this.postRenderCallback=c.postRenderCallback||function(){},this.hoverCallback=c.hoverCallback||function(){},this.outCallback=c.outCallback||function(){},this.clickCallback=c.clickCallback||function(){},this.allowHoverOnDisabled=c.allowHoverOnDisabled||!1,this.allowClickOnDisabled=c.allowClickOnDisabled||!1,this.notAvailable=c.notAvailable||{prev:[],current:[],next:[]},e=document.querySelector(this.el),f={},this.language=c.language&&"zh"!=c.language?{year:"year",month:"month",week:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]}:{year:"年",month:"月",week:["星期一","星期二","星期三","星期四","星期五","星期六","星期日"]},this._getToolsDOM=function(){var a='<div class="calendar-tool"><button type="button" id="calendarPrev" class="calendar-prev" data-type="calendar-btn">'+this.iconPrev+"</button>"+'<span class="calendar-year-month">'+'<span class="calendar-year" id="calendarYear" data-value=""></span>'+this.language.year+'<span class="calendar-month" id="calendarMonth" data-value=""></span>'+this.language.month+"</span>"+'<button type="button" id="calendarNext" class="calendar-next" data-type="calendar-btn">'+this.iconNext+"</button>"+"</div>";return a},this._countGapDays=function(a,b){return a==b?0:a>b?7-a+b:b>a?b-a:void 0},this._getCalendarDOM=function(a,c,d,e){var p,q,r,s,t,u,v,w,x,y,z,A,f="",g="",h="",i="",j=!1,k=1,l=1,m=this.weekStart,n=a,o=c;switch(1==c?(o=12,n=a-1):o=c-1,p=b.getDaysOfMonth(n,o),q=b.getDaysOfMonth(a,c),r=p-this._countGapDays(m,e)+1,s="",t=this.datePosition,t){case"leftTop":s+='<div class="calendar-date-leftBottom">'+this.leftBottomHTML+"</div>"+'<div class="calendar-date-rightTop">'+this.rightTopHTML+"</div>"+'<div class="calendar-date-rightBottom">'+this.rightBottomHTML+"</div>";break;case"leftBottom":s+='<div class="calendar-date-leftTop">'+this.leftTopHTML+"</div>"+'<div class="calendar-date-rightTop">'+this.rightTopHTML+"</div>"+'<div class="calendar-date-rightBottom">'+this.rightBottomHTML+"</div>";break;case"rightTop":s+='<div class="calendar-date-leftTop">'+this.leftTopHTML+"</div>"+'<div class="calendar-date-leftBottom">'+this.leftBottomHTML+"</div>"+'<div class="calendar-date-rightBottom">'+this.rightBottomHTML+"</div>";break;case"rightBottom":s+='<div class="calendar-date-leftTop">'+this.leftTopHTML+"</div>"+'<div class="calendar-date-leftBottom">'+this.leftBottomHTML+"</div>"+'<div class="calendar-date-rightTop">'+this.rightTopHTML+"</div>"}for(f+='<div class="calendar-date-row">',u=0;7>u;u++)m!=e?p>=r?(v="",j=this.isInArray(r,this.notAvailable.prev),g=" calendar-last-month",this.showLastMonth&&"yes"==this.showLastMonth&&(v+='<div class="calendar-date '+this.datePosition+" "+this.lastMonthDateStyle+'" data-type="date">'+r+"</div>"+(j&&!this.displayInfoOnDisabled?"":s),i=j?"not-available":""),f+='<div class="calendar-date-item '+i+g+'" data-type="calendar-item">'+v+"</div>",r++):(j=this.isInArray(l,this.notAvailable.current),i=j?"not-available":"",f+='<div class="calendar-date-item '+i+'" data-type="calendar-item">'+'<div class="calendar-date '+this.datePosition+" "+this.thisMonthDateStyle+'" data-type="date">'+l+"</div>"+(j&&!this.displayInfoOnDisabled?"":s)+"</div>",l++):(j=this.isInArray(l,this.notAvailable.current),i=j?"not-available":"",f+='<div class="calendar-date-item '+i+'" data-type="calendar-item">'+'<div class="calendar-date '+this.datePosition+" "+this.thisMonthDateStyle+'" data-type="date">'+l+"</div>"+(j&&!this.displayInfoOnDisabled?"":s)+"</div>",l++);for(f+="</div>",w=!0;w&&q>l;){for(f+='<div class="calendar-date-row">',u=0;7>u;u++)j=this.isInArray(l,this.notAvailable.current),i=j?"not-available":"",f+='<div class="calendar-date-item '+i+'" data-type="calendar-item">'+'<div class="calendar-date '+this.datePosition+" "+this.thisMonthDateStyle+'" data-type="date">'+l+"</div>"+(j&&!this.displayInfoOnDisabled?"":s)+"</div>",l++;f+="</div>",l+6>q&&(w=!1)}if(q>=l){for(f+='<div class="calendar-date-row">',u=0;7>u;u++)q>l-1?(j=this.isInArray(l,this.notAvailable.current),i=j?"not-available":"",f+='<div class="calendar-date-item '+i+'" data-type="calendar-item">'+'<div class="calendar-date'+" "+this.datePosition+" "+this.thisMonthDateStyle+'" data-type="date">'+l+"</div>"+(j&&!this.displayInfoOnDisabled?"":s)+"</div>",l++):(x="",j=this.isInArray(k,this.notAvailable.current),h="calendar-next-month",this.showNextMonth&&"yes"==this.showNextMonth&&(x+='<div class="calendar-date '+this.datePosition+" "+this.nextMonthDateStyle+'" data-type="date">'+k+"</div>"+(j&&!this.displayInfoOnDisabled?"":s),i=j?"not-available":""),f+='<div class="calendar-date-item '+i+" "+h+'" data-type="calendar-item">'+x+"</div>",k++);f+="</div>"}for(y="",z=this.language,u=m;m+7>u;u++)A=7>u?u:u-7,y+='<div class="calendar-header-item">'+z.week[A]+"</div>";return'<div class="calendar-content"><div class="calendar-header">'+y+"</div>"+'<div class="calendar-body">'+f+"</div>"+"</div>"},this._setTools=function(a,b){var c=e.querySelector("#calendarYear"),d=e.querySelector("#calendarMonth");c.setAttribute("data-value",a),c.innerText=a,d.setAttribute("data-value",b),d.innerText=b,f.prev?(f.year=c.getAttribute("data-value"),f.month=d.getAttribute("data-value")):f={prev:document.querySelector("#calendarPrev"),next:document.querySelector("#calendarNext"),year:c.getAttribute("data-value"),month:d.getAttribute("data-value")}},this._updateCalender=function(a,b){this._setTools(a,b);var c=this._getCalendarDOM(a,b,this.getDaysOfMonth(a,b),this.getFirstDay(a,b));e.querySelector(".calendar-content").outerHTML=c,this._bindEvents().itemEventsBind()},this._render=function(a,b){var g,c=a||this.year,d=b||this.month,f=this._getCalendarDOM(c,d,this.getDaysOfMonth(c,d),this.getFirstDay(c,d));e.childNodes.length?this._updateCalender(c,d):(g=this._getToolsDOM(),e.innerHTML=g+f,this._setTools(c,d))},this._bindEvents=function(){return f.prev,f.next,{onceEventsBind:function(){[].forEach.call(e.querySelectorAll('[data-type="calendar-btn"]'),function(a){a.addEventListener("click",function(){b.preRenderCallback();var a=this,c=f.year,d=f.month,e=a.getAttribute("id");"calendarPrev"==e?1==d?(d=12,c--):d--:"calendarNext"==e&&(12==d?(d=1,c++):d++),b.year=c,b.month=d,b._render(c,d),b.postRenderCallback()},!1)})},itemEventsBind:function(){function a(a){a.addEventListener("mouseenter",function(){b.hoverCallback.call(a)}),a.addEventListener("mouseleave",function(){b.outCallback.call(a)})}function c(a){a.addEventListener("click",function(){b.clickCallback.call(a)})}[].forEach.call(e.querySelectorAll('[data-type="calendar-item"]'),function(d){d.className.indexOf("not-available")>-1?(b.allowHoverOnDisabled&&function(b){a(b)}(d),b.allowClickOnDisabled&&function(a){c(a)}(d)):function(b){a(b),c(b)}(d)})}}},this._trigger=function(a,b){var c;return document.createEventObject?(c=document.createEventObject(),a.fireEvent("on"+b,c)):(c=document.createEvent("HTMLEvents"),c.initEvent(b,!0,!0),!a.dispatchEvent(c))}}b.prototype.getDaysOfMonth=function(a,b){var c=0;switch(Number(b)){case 1:case 3:case 5:case 7:case 8:case 10:case 12:c=31;break;case 4:case 6:case 9:case 11:c=30;break;case 2:c=0==a%4||0==a%400&&0!=a%100?29:28}return c},b.prototype.getFirstDay=function(a,b){var c=-1,d=new Date(a,b-1,1);return c=d.getDay(),0==c?c=6:c-=1,c},b.prototype.isInArray=function(a,b){try{[].forEach.call(b,function(b){if(a==b)throw!1})}catch(c){return!0}return!1},c.prototype=new b,c.prototype.constructor=c,c.prototype.init=function(){this._render();var a=this._bindEvents();a.onceEventsBind(),a.itemEventsBind()},c.prototype.updateContent=function(a){var c,d,e,f,b=a||{};if(this.leftTopHTML=b.leftTopHTML?b.leftTopHTML:"",this.leftBottomHTML=b.leftBottomHTML?b.leftBottomHTML:"",this.rightTopHTML=b.rightTopHTML?b.rightTopHTML:"",this.rightBottomHTML=b.rightBottomHTML?b.rightBottomHTML:"",c=b.notAvailable,d=this.notAvailable,c)for(e in c)f=c[e],d[e]=f?f:[];else d={prev:[],current:[],next:[]};return this},c.prototype.render=function(a,b){return this._render(a,b),this},c.prototype.prev=function(){return this._trigger(document.querySelector("#calendarPrev"),"click"),this},c.prototype.next=function(){return this._trigger(document.querySelector("#calendarNext"),"click"),this},a.Calendar=c}(window);